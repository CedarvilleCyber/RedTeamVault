

## Exchange Weaknesses:
- Groups often have lots of privileges in Exchange, and can be utilized for privilege escalation if understood properly.

"**Exchange Windows Permissions**": Members can write to the DACL, adding themselves to **DCSync** privileges.

"**Organizational Management**": Effectively the "Domain Admins" of Exchange, can access all the mailboxes of all domain users.

**Dumping credentials from memory on a domain controller** will produce lots of cleartext credentials due to users logging in to Outlook Web Access (OWA) and the server caching their credentials.

## PrivExchange attack
-> A weakness that allows a domain user with a mailbox to get the exchange server to authenticate to any host over HTTP.


## MS14-068 (CVE‑2014‑6324)
Allows a user to force a Privilege Attribute Certificate (PAC) to authenticate to the KDC as an administrator

## Sniffing LDAP credentials
Sometimes printers will have stored credentials. Some printers have a 'test connection' functionality where we can point the connection back to our attacker machine and gather creds from the printer that way. (setup a netcat listener on port 389)

## Enumerating DNS Records:
More thorough enumeration of DNS records can give us better insight into the domain.

We can use a tool (with valid domain creds) such as `adidnsdump`
```shell
adidnsdump -u inlanefreight\\forend ldap://172.16.5.5 
```

## What is LDAP?
Phonebook. Store user information and authentication.

Map out your organization.

LDAP -> AD
OpenLDAP -> Linux

LDAP Provides the *information* about what services a user can access, but does not actually enforce that access. (provides the data to systems that do enforce)

**Rather than having 500 servers on a big network that contain a database to authenticate individuals**, an LDAP server can be used to centralize that authentication.


## Password in Description Field
Utilize Powerview `Get-DomainUser` module to find sensitive information in the description field of AD users.
```powershell
Get-DomainUser * | Select-Object samaccountname,description |Where-Object {$_.Description -ne $null}
```

## PASSWD_NOTREQD Field
If this is set, the user is not subject to the current password policy length, meaning they could have a shorter password or no password at all (if empty passwords are allowed in the domain).
````powershell
Get-DomainUser -UACFilter PASSWD_NOTREQD | Select-Object samaccountname,useraccountcontrol
````

## Credentials in SMB Shares and SYSVOL Scripts

```powershell
ls \\academy-ea-dc01\SYSVOL\INLANEFREIGHT.LOCAL\scripts
```

## Group Policy Preferences (GPP) Passwords

Sensitive data can be stored on the SYSVOL share
```shell

 crackmapexec smb 172.16.5.5 -u forend -p Klmcargo2         -M gpp_autologin
# Look for exposed credentials for a machine or user that automatically logs on
```

## ASREPRoasting
-> Obtain TGTs for any account that has the `do not require Kerberos pre-authentication`

> The success of this attack depends on the account having a relatively weak password.

- **Kerberoasting** = crack service account credentials via SPN service tickets.
- **AS-REP Roasting** = crack user passwords directly by exploiting accounts without pre-authentication.

