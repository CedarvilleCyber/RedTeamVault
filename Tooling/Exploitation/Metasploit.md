Metasploit is an exploitation framework that is essential to any penetration testing toolbox. It packages hundreds of exploits with plug-and-play functionality to give you a smooth experience, providing also the [[MSFVenom]] payload generation tool and the [[Meterpreter]] implant. 

A good, free course on Metasploit usage can be found here: https://www.offsec.com/metasploit-unleashed/
This course covers Metasploit usage in-depth, and is a great point to start from. 

> [!warning]
> Please take the time to understand your exploits. Metasploit is a very powerful tool, but it is also one that can isolate you from the process to an unhealthy degree. Always attempt to understand your environment and the exploits that you are running, so you do not accidentally damage your target in unintended ways. An easy way to do this is with the builtin `edit` command. 

# General Usage

Start the interactive framework with 
```shell
msfconsole # Start the Metasploit Framework interactive console
```

Use the following commands to navigate modules
```shell
msf6> help # Get a comprehensive listing of commands
msf6> search <search  term> # search for an exploit with key terms
msf6> use <name or number> # Select an exploit to interact with
msf6> back # Unselect the selected exploit
```

Use the following commands to navigate sessions
```
msf6> sessions # List running Meterpreter or command shell sessions
msf6> sessions -i <number> # Interact with a session
msf6> sessions -u <number> # Upgrade a session to a Meterpreter shell
```

Use the following commands to use exploits
```shell
msf6> set <property> <value> # Set options on an exploit module
msf6> setg <property> <value> # Set an option globally for all modules. ex: RHOSTS
msf6> options # List main options for exploit and selected payload
msf6> run # Execute the exploit
```

Useful when changing exploits or modules:
```bash
msf6> unset <property> # Unset an option.
msf6> unsetg <property> # Unset an option globally.
```

An example Metasploit attack is shown in the [[EternalBlue]] note file.

TODO: Add database commands and relevance.

# Meterpreter Implant
Meterpreter can be generated as shellcode or an implant or used as the payload for an exploit. If Meterpreter is an exploit payload, you can disregard the necessary setup below, as MSFConsole will handle it for you. 

Use the following commands to interact with the setup for a [[Meterpreter]] session obtained via shellcode or an implant. Used with [[MSFVenom]] as well.
```shell
msf6> use exploit/multi/handler # Use Meterpreter handler
msf6> # Set appropriate options for payload (PAYLOAD, LHOST, LPORT, EXITFUNC (maybe))
msf6> run # Begin listening for connections
```

>[!note] 
>If you're having issues catching your shell (ex: segmentation fault or shell not connecting), check to make sure you set the right payload option in your multi/handler.
# Elements of Metasploit
## Common Elements:
- `RHOST`: "remote host." This is the target you're trying to exploit.
- `LHOST`: "local host." This is Metasploit's way of referring to your machine. Without this option, the payload doesn't know who to call back to.
- `RPORT`: "remote port." This is the port that the vulnerable service is running on.
- `SESSION`: each connection to a target system has a session ID. This session ID allows you to add post-exploitation modules to your connection.
## Modules
### Auxiliary
Supporting modules such as scanners, crawlers, and fuzzers can be found here. 
### Encoders
Encoders allow you to encode exploits and payloads to try to obfuscate them so that signature-based antivirus systems don't detect them. 
- These may be relatively ineffective
### Evasion
Evasion modules attempt to help your payload evade antivirus software.
### Exploits
These are organized by target system.
### NOPs
These are No Operation bytecodes for various architectures. 
### Payloads
#### Adapters
Adapters wrap single payloads to convert them into different formats. For example, a PowerShell adapter would make a PowerShell command for you that would execute the payload. 
#### Singles
These are self-contained payloads. They don't need to download any additional components to run, so a "single" payload is always a good choice. I consider it to be the default type of payload.

Singles are in a shell_reverse directory, whereas staged payloads are in a shell/reverse payload.
#### Stagers
Stagers are a special type of payload that is designed to download a larger payload. Stagers are lightweight and stealthy, but they don't have many features. 
#### Stages
These are larger, more capable, more fully-featured payloads. You want to get one of these onto the target machine. To do so, you use a stager.
### Post
Post modules are for post-exploitation. 

## MSFconsole
This is the Metasploit Framework's interactive console. If you're using Metasploit, you'll most likely be interacting with MSFconsole.
- MSFconsole supports tab completion (similarly to bash and zsh), which is very helpful. 
# Resources:
[TryHackMe Metasploit Intro Room](https://tryhackme.com/r/room/metasploitintro)

